# Description
This repository contains information about the pycover.py script which is used to process gcov based code coverage results.

# File Format Descriptions
GCov utilizes two different file formats in the processing of code coverage information.  GCov uses a 'Notes' file or '.gcno' file to record information about the branches, arcs and blocks that are associate with a source file and a 'Data' file or '.gcda' file.  There is also a third file format '.info' file which is historically generated by 'geninfo' and processed by 'lcov' in order to be able to generate code coverage reports.

The 'pycover.py' script can perform the function of geninfo and process data sources from varying locations in order to generate a '.info' file that combines all the information captured for a given code coverage run.  The 'pycover.py' script can then also process the '.info' file in order to create HTML reports that show detailed information about the coverage associated with the captured code coverage data.

The following section describes the '.gcno' and '.gcda' that the 'pycover.py' script consumes in order to generate the intermediate '.info' file and also describes the format of the '.info' file that it processes in order to create the HTML coverage report.

## Notes (.gcno) and Data (.gcda) Common File Format

### High Level Format
```
[FileHeader] [Record] ... (up-to-end of file)
```

### File Header Description

```
[magic] [version] [stamp]
```

### Record Description

```
[Record Header] [Record Buffer]
```

#### Record Header

```
[Tag] [Length]
```

#### Record Buffer

```
[Item] [Item] [Item] ... (up-to-end of buffer)
```

## Notes (.gcda) Record Formats

```
[Unit] [Function Graph: SECTION] [Function Graph: SECTION] ... (up-to-end of file)
```

### Unit Record

```
[Checksum: UINT32] [Source: STRING]
```

### Function Graph Record

```
[Function Announcement] [Basic Blocks] [Arc Set (one per basic block)] [Line Set (zero or more to end-of-record)]
```

#### Function Announcement

#### Basic Blocks
The 'Basic Blocks' record indicates the number of blocks thar are applicable to the previously announced function.  The record contains a series of 'Flag' entries that are 'UINT32' values that provide information about the corresponding blocks.  There is a one to one correspondence between the 'Flag' entries and the number of blocks in a functions.  The 'Basic Blocks' record is a good way to determine the number of blocks that apply to a function.  The record length is used to determine the number of flag entries.  A record length of 5 would mean there are 5 'Flag' entries that follow and thus 5 blocks associated with the function.

```
[Record Header: (tag, length)] [Flag: UInt32] ... (up-to-end of record)
```

#### Arc Set
There is exactly one 'Arc Set' record for every basic block in a function.  The 'Arc Set' records are not ordered for a given function but can be matched to a functions basic block using the 'BlockNo' field.  The 'BlockNo' field is a zero indexed value from 0 to (block count -1) that is the index of the block that the 'Arc Set' information applies to.  The 'Arc Set' record is an enumeration of the arcs that are applicable for blocks and the flags that apply for each block.

```
[Record Header: (tag, length)] [BlockNo: UInt32] [Arc] ... (up-to-end of record)
```

An 'Arc' item consists of:

```
[DestBlock: UINT32] [Flags: UINT32]
```
GCOV code coverage is arc based coverage.  The arcs are used to construct a directed graph that depicts the possible program flow paths between the basic blocks that make up a function.  The basic blocks correspond to the nodes in the graph and the arcs correspond to the edges or paths between the nodes in the graph.



#### Line Set

```
[Record Header: (tag, length)] [BlockNo: UInt32] [Line] ... (up-to-end of record)
```

```
[LineNo: UINT32 = 0] [Source: STRING]
[LineNo: UINT32 = (line number)] [Source: STRING (NULL)]
[LineNo: UINT32 = 0] [Source: STRING(NULL)]
```


## Data (.gcda) Record Formats

## Info (.info) File Format


# Function Graphs

![Directed Graph Legend](images/directed-graph-legend.gif)

![Simple Call](images/simple-call.gif)

![Simple Branch](images/simple-branch.gif)

![Simple Block](images/simple-block.gif)

![Multiple Branches](images/multiple-branches.gif)

![Multiple Branches with Calls](images/multiple-branches-with-calls.gif)


